<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Simple and Easy-to-Use API Documentation" />
  <meta name="theme-color" content="#121212" />
  <!-- The title will be overwritten by the settings.json config -->
  <title>API Dashboard</title>

  <!-- Preconnect & Preload fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" as="style" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" />

  <!-- Material Icons -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" />

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif']
          },
          colors: {
            darkBg: "#0a0a14",
            primary: {
              50: '#f3e8ff',
              100: '#e9d5ff',
              200: '#d8b4fe',
              300: '#c084fc',
              400: '#a855f7',
              500: '#9333ea',
              600: '#7e22ce',
              700: '#6b21a8',
              800: '#581c87',
              900: '#4c1d95'
            },
            pink: {
              50: '#fdf2f8',
              100: '#fce7f3',
              200: '#fbcfe8',
              300: '#f9a8d4',
              400: '#f472b6',
              500: '#ec4899',
              600: '#db2777',
              700: '#be185d',
              800: '#9d174d',
              900: '#831843'
            }
          }
        }
      }
    }
  </script>
  <!-- Particles.js library -->
  <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
  <style>
    /* Overall dark background */
    body {
      background-color: #0a0a14;
      color: #e4e4e7;
      overflow-x: hidden;
      scroll-behavior: smooth;
    }
    /* Prevent scrolling on the main content when the sidebar is open */
    body.sidebar-open {
      overflow: hidden;
    }
    /* Particles container */
    #particles-js {
      position: fixed;
      width: 100%;
      height: 100%;
      z-index: -1;
      top: 0;
      left: 0;
    }
    /* Gradient text style */
    .gradient-text {
      background: linear-gradient(135deg, #9333ea, #ec4899);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    /* Glass card style with gradient border/background */
    .glass-card {
      background: linear-gradient(135deg, rgba(147,51,234,0.1), rgba(236,72,153,0.1));
      border: 2px solid transparent;
      border-image: linear-gradient(135deg, #9333ea, #ec4899) 1;
      backdrop-filter: blur(10px);
    }
    /* Header styles for home and sidebar (exactly matching) */
    .header-bg,
    .sidebar-bg {
      /* Using the same glass-card design */
      background: linear-gradient(135deg, rgba(147,51,234,0.1), rgba(236,72,153,0.1));
      border: 2px solid transparent;
      border-image: linear-gradient(135deg, #9333ea, #ec4899) 1;
      backdrop-filter: blur(10px);
    }
    /* Gradient button style matching glass cards */
    .gradient-btn {
      background: linear-gradient(135deg, rgba(147,51,234,0.1), rgba(236,72,153,0.1));
      border: 2px solid transparent;
      border-image: linear-gradient(135deg, #9333ea, #ec4899) 1;
      color: #fff;
      backdrop-filter: blur(10px);
    }
    :focus-visible {
      outline: 2px solid #7c3aed;
      outline-offset: 2px;
    }
    /* Sidebar styles */
    #sidebar {
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      height: 100vh;
      display: flex;
      flex-direction: column;
      width: 320px;
    }
    #sidebar-content {
      overflow-y: auto;
      flex-grow: 1;
      scrollbar-width: thin;
      scrollbar-color: rgba(124,58,237,0.3) rgba(0,0,0,0.1);
    }
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: rgba(0,0,0,0.1); }
    ::-webkit-scrollbar-thumb {
      background-color: rgba(124,58,237,0.3);
      border-radius: 4px;
    }
    ::-webkit-scrollbar-thumb:hover { background-color: rgba(124,58,237,0.5); }
    #main-content {
      transition: margin-left 0.3s cubic-bezier(0,0,0.2,1);
    }
    /* Loading Screen with animated gradient background */
    #loadingScreen {
      position: fixed;
      inset: 0;
      z-index: 50;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #0a0a14, #1a1a2e, #0f3460);
      background-size: 400% 400%;
      animation: gradientAnimation 10s ease infinite;
    }
    @keyframes gradientAnimation {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    /* Enhanced loading spinner with glow effect */
    .loading-spinner {
      display: inline-block;
      width: 2rem;
      height: 2rem;
      border: 3px solid rgba(124, 58, 237, 0.2);
      border-radius: 50%;
      border-top-color: #9333ea;
      border-left-color: #ec4899;
      animation: spin 1s cubic-bezier(0.68, -0.55, 0.27, 1.55) infinite;
      box-shadow: 0 0 15px rgba(147, 51, 234, 0.5);
    }
    @keyframes spin { 
      to { transform: rotate(360deg); } 
    }
    /* Loading bar animation */
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    #loadingBar {
      animation: pulse 1.5s ease-in-out infinite;
      box-shadow: 0 0 10px rgba(147, 51, 234, 0.7);
    }
    /* Ripple effect */
    .ripple {
      position: relative;
      overflow: hidden;
      transform: translate3d(0,0,0);
    }
    .ripple:after {
      content: "";
      display: block;
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      pointer-events: none;
      background-image: radial-gradient(circle, #fff 10%, transparent 10.01%);
      background-repeat: no-repeat;
      background-position: 50%;
      transform: scale(10,10);
      opacity: 0;
      transition: transform .5s, opacity 1s;
    }
    .ripple:active:after {
      transform: scale(0,0);
      opacity: .3;
      transition: 0s;
    }
    @media (min-width: 1024px) {
      #sidebar { transform: translateX(0)!important; }
      #main-content { margin-left: 320px; }
    }
    @media (max-width: 1023px) {
      #sidebar { transform: translateX(-100%); }
      body.sidebar-open #sidebar { transform: translateX(0); }
      body.sidebar-open #overlay { display: block; }
    }
    .fade-in { animation: fadeIn 0.3s cubic-bezier(0.4,0,0.2,1); }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .slide-in { animation: slideIn 0.3s cubic-bezier(0.4,0,0.2,1); }
    @keyframes slideIn { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    @media (prefers-reduced-motion: reduce) {
      *, ::before, ::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
      }
      .fade-in, .slide-in { animation: none !important; opacity: 1; transform: translateY(0); }
    }
    /* Fully blur the notification panel with an opaque background */
    #notificationPanel {
      backdrop-filter: blur(20px);
      background: rgba(0, 0, 0, 0.8);
    }
  </style>
</head>
<body class="min-h-screen font-sans flex">
  <!-- Particles.js container -->
  <div id="particles-js"></div>

  <!-- Skip to main content link for accessibility -->
  <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:p-4 focus:bg-primary-700 focus:text-white focus:z-50">
    Skip to main content
  </a>

  <!-- Global Loading Screen -->
  <div id="loadingScreen" class="fixed inset-0 z-50 flex flex-col items-center justify-center transition-opacity duration-300" aria-live="polite" aria-busy="true">
    <div class="relative w-64 h-4 bg-gray-800 rounded-full overflow-hidden mb-6">
      <div id="loadingBar" class="absolute left-0 top-0 h-full w-0 bg-gradient-to-r from-primary-600 to-pink-500 rounded-full transition-all duration-1000"></div>
    </div>
    <div class="loading-spinner mb-6"></div>
    <p class="text-pink-200 text-xl font-medium mt-2">Loading dashboard...</p>
  </div>

  <!-- Overlay for mobile -->
  <div id="overlay" class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden lg:hidden backdrop-blur-sm" aria-hidden="true"></div>

  <!-- Sidebar -->
  <aside id="sidebar" class="glass-card fixed inset-y-0 left-0 z-30" aria-label="Sidebar navigation">
    <div class="flex flex-col h-full">
      <!-- Sidebar Header -->
      <div class="h-16 glass-card flex-shrink-0 flex items-center px-4">
        <div id="sidebarHeaderDefault" class="flex items-center w-full justify-between">
          <h2 class="text-lg font-medium text-white gradient-text">Jea's Api</h2>
          <button id="sidebarSearchIcon" class="icon-circle w-10 h-10 hover:bg-purple-700/20 rounded-full transition-colors ripple" aria-label="Search APIs">
            <span class="material-icons-round text-purple-300" style="font-size: 20px;">search</span>
          </button>
        </div>
        <div id="sidebarSearchBar" class="hidden w-full">
          <div class="flex items-center w-full">
            <div class="relative w-full">
              <input type="text" id="api-search" placeholder="Search APIs..." 
                     class="w-full p-2 pl-3 pr-8 rounded-md bg-black bg-opacity-50 border border-purple-700/30 text-white placeholder-gray-400 focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                     aria-label="Search APIs">
              <button id="clearSearch" class="absolute right-2 top-1/2 transform -translate-y-1/2 p-1 hover:text-purple-300 transition-colors" aria-label="Clear search">
                <span class="material-icons-round" style="font-size: 18px;">close</span>
              </button>
            </div>
            <button id="closeSearch" class="ml-2 px-3 py-2 hover:bg-purple-700/20 rounded-md transition-colors ripple" aria-label="Close search">
              Close
            </button>
          </div>
        </div>
      </div>
      <!-- Sidebar Content -->
      <div id="sidebar-content" class="flex-grow overflow-y-auto p-4">
        <div class="flex justify-center items-center h-32">
          <div class="loading-spinner" aria-label="Loading API categories"></div>
        </div>
      </div>
    </div>
  </aside>

  <!-- Main Content -->
  <div id="main-content" class="flex-1 flex flex-col min-h-screen relative z-10">
    <!-- Home Header -->
    <header class="glass-card fixed top-0 left-0 right-0 h-16 flex-shrink-0 flex items-center px-4 transition-colors duration-200 sticky z-10">
      <button id="menuButton" class="icon-circle w-10 h-10 hover:bg-purple-700/20 rounded-full lg:hidden transition-colors ripple" aria-label="Toggle menu" aria-expanded="false" aria-controls="sidebar">
        <span class="material-icons-round text-gray-200" style="font-size: 24px;">menu</span>
      </button>
      <h1 class="text-lg font-medium flex-1 text-center lg:text-left lg:ml-2 gradient-text">Jea UI</h1>
      <!-- Notification Button -->
      <div class="flex items-center">
        <div class="relative">
          <button id="notificationButton" class="icon-circle w-10 h-10 hover:bg-purple-700/20 rounded-full relative transition-colors ripple" aria-label="Notifications" aria-haspopup="true" aria-expanded="false" aria-controls="notificationPanel">
            <span class="material-icons-round text-gray-300" style="font-size: 20px;">notifications</span>
            <span id="notificationBadge" class="absolute top-0 right-0 inline-flex items-center justify-center px-1.5 py-0.5 text-xs font-bold text-white bg-purple-600 rounded-full"></span>
          </button>
          <div id="notificationPanel" class="modal-bg absolute right-0 mt-2 w-80 rounded-lg hidden z-40 fade-in border border-gray-700 overflow-hidden" role="menu" aria-labelledby="notificationButton"></div>
        </div>
      </div>
    </header>

    <!-- Hero Section -->
    <section class="flex flex-col items-center justify-center text-center py-12 px-4 space-y-6 mt-20">
      <h2 class="text-4xl font-bold gradient-text">Jea's Api</h2>
      <p class="max-w-2xl text-lg text-gray-200">
        Simple and Easy-to-Use API Documentation
      </p>
      <div class="flex space-x-4">
        <a id="githubLink" href="#" target="_blank" rel="noopener noreferrer" class="gradient-btn px-6 py-2 rounded-md shadow-md transition-colors ripple">
          Source Code
        </a>
        <a id="telegramLink" href="#" target="_blank" rel="noopener noreferrer" class="gradient-btn px-6 py-2 rounded-md shadow-md transition-colors ripple">
          Contact Me
        </a>
      </div>
    </section>

    <!-- Stats Cards -->
    <div class="grid gap-4 md:grid-cols-2 fade-in slide-in px-4">
      <div class="glass-card rounded-lg p-5 shadow-lg border border-transparent card-hover">
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-3">
            <div class="icon-circle w-12 h-12 bg-purple-900/50 flex items-center justify-center" aria-hidden="true">
              <span class="material-icons-round text-purple-400" style="font-size: 28px;">dns</span>
            </div>
            <div>
              <h3 class="text-sm font-medium text-gray-300">Total Endpoints</h3>
              <p class="text-3xl font-bold text-white total-endpoints" aria-live="polite">
                <span class="loading-spinner mr-2"></span>
                <span class="sr-only">Loading endpoint count</span>
              </p>
            </div>
          </div>
        </div>
      </div>
      <div class="glass-card rounded-lg p-5 shadow-lg border border-transparent card-hover">
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-3">
            <div class="icon-circle w-12 h-12 bg-purple-900/50 flex items-center justify-center" aria-hidden="true">
              <span class="material-icons-round text-purple-400" style="font-size: 28px;">category</span>
            </div>
            <div>
              <h3 class="text-sm font-medium text-gray-300">Total Categories</h3>
              <p class="text-3xl font-bold text-white total-categories" aria-live="polite">
                <span class="loading-spinner mr-2"></span>
                <span class="sr-only">Loading category count</span>
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Featured APIs Section – Top 5 Most Used (Individual Cards Only) -->
    <section class="fade-in slide-in mx-4 my-6" aria-labelledby="featured-apis-heading">
      <div class="flex items-center space-x-2 mb-4">
        <span class="material-icons-round text-purple-400" aria-hidden="true">star</span>
        <h2 id="featured-apis-heading" class="text-xl font-medium text-white">Top 5 Most Used APIs</h2>
      </div>
      <div class="grid gap-3 md:grid-cols-2 lg:grid-cols-3" id="featuredApis" aria-live="polite">
        <!-- Top 5 APIs will be populated dynamically as individual cards -->
      </div>
    </section>

    <!-- Footer -->
    <footer class="glass-card shadow-lg mt-auto border-t border-transparent mx-4 my-6">
      <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
        <p class="text-sm text-gray-300 text-center">
          &copy; <span id="current-year"></span> <span id="creator">AjiroDesu</span>
        </p>
      </div>
    </footer>
  </div>

  <!-- API Response Modal -->
  <div id="apiResponseModal" class="fixed inset-0 z-50 bg-black bg-opacity-70 hidden overflow-y-auto backdrop-blur-sm" aria-labelledby="apiResponseModalLabel" aria-modal="true" role="dialog">
    <div class="min-h-screen flex items-center justify-center p-4">
      <div class="glass-card modal-bg border border-transparent rounded-xl w-full max-w-4xl max-h-[90vh] flex flex-col shadow-lg fade-in slide-in">
        <!-- Modal Header -->
        <div class="flex justify-between items-start p-6 border-b border-transparent modal-bg rounded-t-xl">
          <div>
            <h3 class="text-xl font-medium text-white" id="apiResponseModalLabel"></h3>
            <p class="text-gray-300 text-sm mt-1" id="apiResponseModalDesc"></p>
          </div>
          <button type="button" id="closeModalBtn" class="icon-circle w-10 h-10 text-gray-300 hover:text-white hover:bg-black hover:bg-opacity-50 transition-colors ripple rounded-full" aria-label="Close modal">
            <span class="material-icons-round">close</span>
          </button>
        </div>
        <!-- Modal Body -->
        <div class="p-6 overflow-y-auto flex-1">
          <div class="glass-card rounded-lg p-4 border border-transparent mb-6" id="apiEndpointContainer">
            <div class="flex items-center justify-between mb-2">
              <h4 class="text-sm font-medium text-gray-300">Endpoint URL</h4>
              <button id="copyEndpointBtn" class="text-purple-400 hover:text-purple-300 p-1 rounded-full hover:bg-purple-900/30 transition-colors text-xs flex items-center space-x-1 ripple" aria-label="Copy endpoint URL">
                <span class="material-icons-round" style="font-size: 16px;">content_copy</span>
                <span>Copy</span>
              </button>
            </div>
            <pre id="apiEndpoint" class="text-purple-300 text-sm overflow-x-auto font-mono"></pre>
          </div>
          <div id="apiQueryInputContainer" class="space-y-4" aria-live="polite"></div>
          <div id="apiResponseLoading" class="hidden py-12 flex justify-center" aria-live="polite" aria-busy="true">
            <div class="relative w-12 h-12">
              <div class="absolute inset-0 border-4 border-purple-600/30 border-t-purple-400 rounded-full animate-spin"></div>
            </div>
          </div>
          <div id="apiResponseContainer" class="hidden mt-6" aria-live="polite">
            <div class="flex items-center justify-between mb-2">
              <h4 class="text-sm font-medium text-gray-300">Response</h4>
              <button id="copyResponseBtn" class="text-purple-400 hover:text-purple-300 p-1 rounded-full hover:bg-purple-900/30 transition-colors text-xs flex items-center space-x-1 ripple" aria-label="Copy response">
                <span class="material-icons-round" style="font-size: 16px;">content_copy</span>
                <span>Copy</span>
              </button>
            </div>
            <pre id="apiResponseContent" class="glass-card rounded-lg p-4 text-gray-300 text-sm overflow-x-auto font-mono border border-transparent"></pre>
          </div>
        </div>
        <!-- Modal Footer -->
        <div class="p-6 border-t border-transparent modal-bg rounded-b-xl">
          <button id="submitQueryBtn" class="hidden px-6 py-2.5 bg-purple-600 hover:bg-purple-700 text-white font-medium rounded-lg transition-all shadow-lg hover:shadow-xl flex items-center space-x-2 ripple" aria-live="polite">
            <span class="material-icons-round" style="font-size: 18px;">send</span>
            <span>Submit</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    /* Ajiro API Dashboard */
    class AjiroApiDashboard {
      constructor() {
        this.apiCache = new Map();
        this.sidebar = document.getElementById('sidebar');
        this.mainContent = document.getElementById('main-content');
        this.overlay = document.getElementById('overlay');
        this.menuButton = document.getElementById('menuButton');
        this.searchInput = document.getElementById('api-search');
        this.notificationButton = document.getElementById('notificationButton');
        this.notificationPanel = document.getElementById('notificationPanel');
        this.isSidebarOpen = false;
        this.isDesktop = window.innerWidth >= 1024;
        this.apiEndpoint = '/api/info';

        this.apiResponseModal = document.getElementById('apiResponseModal');
        this.closeModalBtn = document.getElementById('closeModalBtn');
        this.apiResponseModalLabel = document.getElementById('apiResponseModalLabel');
        this.apiResponseModalDesc = document.getElementById('apiResponseModalDesc');
        this.apiEndpointEl = document.getElementById('apiEndpoint');
        this.apiEndpointContainer = document.getElementById('apiEndpointContainer');
        this.apiQueryInputContainer = document.getElementById('apiQueryInputContainer');
        this.apiResponseLoading = document.getElementById('apiResponseLoading');
        this.apiResponseContent = document.getElementById('apiResponseContent');
        this.apiResponseContainer = document.getElementById('apiResponseContainer');
        this.submitQueryBtn = document.getElementById('submitQueryBtn');
        this.copyEndpointBtn = document.getElementById('copyEndpointBtn');
        this.copyResponseBtn = document.getElementById('copyResponseBtn');

        this.init();
      }

      init() {
        this.animateLoading();
        this.startDateTimeUpdate();
        this.initSidebar();
        this.initSearch();
        this.initResizeHandler();
        this.setupSidebarToggle();
        this.setupNotificationButton();
        this.setupSidebarSearch();
        this.setupKeyboardNavigation();
        this.setupModal();
        this.setupCopyButtons();
        this.initFeaturedApis();
        // Poll for updates every 10 seconds for real-time usage
        setInterval(() => this.initFeaturedApis(), 10000);
        document.addEventListener('click', this.handleOutsideClick.bind(this));
        window.addEventListener('error', this.handleGlobalError.bind(this));
        window.addEventListener('unhandledrejection', this.handlePromiseRejection.bind(this));
      }

      handleGlobalError(event) {
        console.error('Global error:', event.message);
        this.showErrorNotification('An error occurred. Please try again.');
        return false;
      }

      handlePromiseRejection(event) {
        console.error('Unhandled promise rejection:', event.reason);
        if (event.reason.message && event.reason.message.includes('fetch')) {
          this.showErrorNotification('Network error. Please check your connection.');
        }
        return false;
      }

      showErrorNotification(message) {
        const notification = document.createElement('div');
        notification.className = 'fixed bottom-4 right-4 bg-red-900 text-white px-4 py-3 rounded-lg shadow-lg z-50 fade-in';
        notification.innerHTML = `
          <div class="flex items-center space-x-2">
            <span class="material-icons-round">error</span>
            <span>${message}</span>
          </div>
        `;
        document.body.appendChild(notification);
        setTimeout(() => {
          notification.style.opacity = '0';
          setTimeout(() => notification.remove(), 300);
        }, 5000);
      }

      animateLoading() {
        const loadingBar = document.getElementById('loadingBar');
        let width = 0;
        const interval = setInterval(() => {
          if (width >= 100) {
            clearInterval(interval);
            setTimeout(() => {
              const loadingScreen = document.getElementById('loadingScreen');
              loadingScreen.style.opacity = '0';
              loadingScreen.setAttribute('aria-busy', 'false');
              setTimeout(() => { 
                loadingScreen.style.display = 'none';
                this.announceToScreenReader('Dashboard loaded and ready');
              }, 500);
            }, 500);
          } else {
            width += 2;
            loadingBar.style.width = width + '%';
          }
        }, 20);
      }

      announceToScreenReader(message) {
        const announcer = document.createElement('div');
        announcer.setAttribute('aria-live', 'assertive');
        announcer.className = 'sr-only';
        document.body.appendChild(announcer);
        setTimeout(() => {
          announcer.textContent = message;
          setTimeout(() => announcer.remove(), 1000);
        }, 100);
      }

      handleOutsideClick(e) {
        if (this.notificationPanel && !this.notificationButton.contains(e.target) &&
            !this.notificationPanel.contains(e.target)) {
          this.notificationPanel.classList.add('hidden');
          this.notificationButton.setAttribute('aria-expanded', 'false');
        }
      }

      setupKeyboardNavigation() {
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape') {
            if (!this.notificationPanel.classList.contains('hidden')) {
              this.notificationPanel.classList.add('hidden');
              this.notificationButton.setAttribute('aria-expanded', 'false');
              this.notificationButton.focus();
            }
            const searchBar = document.getElementById('sidebarSearchBar');
            const defaultHeader = document.getElementById('sidebarHeaderDefault');
            if (!searchBar.classList.contains('hidden') && !this.isDesktop) {
              this.searchInput.value = "";
              this.handleSearch({ target: { value: "" } });
              searchBar.classList.add('hidden');
              defaultHeader.classList.remove('hidden');
              document.getElementById('sidebarSearchIcon').focus();
            }
            if (this.isSidebarOpen && !this.isDesktop) {
              this.closeSidebar();
              this.menuButton.focus();
            }
            if (!this.apiResponseModal.classList.contains('hidden')) {
              this.closeModal();
            }
          }
        });
      }

      startDateTimeUpdate() {
        document.getElementById('current-year').textContent = new Date().getFullYear();
      }

      async initSidebar() {
        const sidebarContent = document.getElementById('sidebar-content');
        const totalEndpointsElement = document.querySelector('.total-endpoints');
        const totalCategoriesElement = document.querySelector('.total-categories');
        try {
          const apiList = await this.fetchApiList();
          const categories = this.groupByCategory(apiList);
          sidebarContent.innerHTML = '';
          this.renderCategories(categories, sidebarContent);
          totalEndpointsElement.innerHTML = apiList.length.toString();
          totalCategoriesElement.innerHTML = Object.keys(categories).length.toString();
          this.setupCategoryListeners();
        } catch (error) {
          console.error('Sidebar initialization error:', error);
          sidebarContent.innerHTML = `
            <div class="p-4 bg-red-900/20 border border-red-800 rounded-lg text-red-300">
              <p class="text-sm font-medium">Failed to load API categories</p>
              <p class="text-xs mt-1">Please try refreshing the page</p>
            </div>
          `;
          totalEndpointsElement.innerHTML = 'Error';
          totalCategoriesElement.innerHTML = 'Error';
        }
      }

      async initFeaturedApis() {
        const featuredApisContainer = document.getElementById('featuredApis');
        try {
          const apiList = await this.fetchApiList();
          let topApis = [];
          if (apiList.length && apiList[0].usage !== undefined) {
            topApis = apiList.sort((a, b) => b.usage - a.usage).slice(0, 5);
          } else {
            topApis = apiList.slice(0, 5);
          }
          featuredApisContainer.innerHTML = '';
          topApis.forEach(api => {
            const card = document.createElement('div');
            card.className = 'glass-card rounded-lg p-4 hover:border-purple-700 transition-all card-hover cursor-pointer';
            card.setAttribute('role', 'button');
            card.setAttribute('tabindex', '0');
            card.setAttribute('aria-label', `Try ${this.capitalizeFirstLetter(api.name)} API`);
            card.innerHTML = `
              <div class="flex items-center">
                <span class="material-icons-round text-purple-400" style="font-size: 18px;" aria-hidden="true">api</span>
                <span class="font-medium text-white ml-2">${this.capitalizeFirstLetter(api.name)}</span>
                <span class="ml-auto text-xs font-bold text-purple-300">${api.method ? api.method.toUpperCase() : 'GET'}</span>
              </div>
              <div class="text-xs text-gray-300 mt-1">Usage: ${api.usage}</div>
            `;
            card.addEventListener('click', () => this.useApi(api.path));
            card.addEventListener('keydown', (e) => {
              if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                this.useApi(api.path);
              }
            });
            featuredApisContainer.appendChild(card);
          });
        } catch (error) {
          console.error('Featured APIs initialization error:', error);
          featuredApisContainer.innerHTML = `
            <div class="col-span-full p-4 bg-red-900/20 border border-red-800 rounded-lg text-red-300">
              <p class="text-sm font-medium">Failed to load featured APIs</p>
              <p class="text-xs mt-1">Please try refreshing the page</p>
            </div>
          `;
        }
      }

      getRandomItems(array, count) {
        const shuffled = [...array].sort(() => 0.5 - Math.random());
        return shuffled.slice(0, count);
      }

      async fetchApiList() {
        try {
          const response = await fetch(this.apiEndpoint);
          if (!response.ok) {
            throw new Error(`Failed to fetch API list: ${response.status} ${response.statusText}`);
          }
          const data = await response.json();
          const apiList = [];
          if (data.categories && Array.isArray(data.categories)) {
            data.categories.forEach(category => {
              if (category.items && Array.isArray(category.items)) {
                category.items.forEach(item => {
                  apiList.push({ ...item, category: category.name });
                });
              }
            });
          }
          this.apiCache.set('apiList', apiList);
          return apiList;
        } catch (error) {
          console.error('Error fetching API list:', error);
          throw error;
        }
      }

      groupByCategory(apiList) {
        return apiList.reduce((acc, api) => {
          (acc[api.category] = acc[api.category] || []).push(api);
          return acc;
        }, {});
      }

      renderCategories(categories, container) {
        if (Object.keys(categories).length === 0) {
          container.innerHTML = `
            <div class="p-4 bg-red-900/20 border border-red-800 rounded-lg text-red-300">
              <p class="text-sm font-medium">No API categories found</p>
              <p class="text-xs mt-1">Please check back later</p>
            </div>
          `;
          return;
        }
        Object.entries(categories)
          .sort((a, b) => a[0].localeCompare(b[0]))
          .forEach(([category, items]) => {
            if (items.length > 0) {
              container.appendChild(this.createCategory(category, items));
            }
          });
      }

      createCategory(category, items) {
        const categoryContainer = document.createElement('div');
        categoryContainer.className = 'category mb-4';
        const headerId = `category-header-${category}`;
        const header = document.createElement('button');
        header.id = headerId;
        header.className = 'category-header w-full text-left flex justify-between items-center p-3 hover:bg-purple-700/30 rounded-lg text-sm transition-colors ripple';
        header.setAttribute('aria-expanded', 'false');
        header.setAttribute('aria-controls', `category-${category}`);
        header.innerHTML = `
          <div class="flex items-center space-x-2">
            <span class="material-icons-round text-purple-400" style="font-size: 18px;" aria-hidden="true">folder</span>
            <span class="font-medium text-white">${this.capitalizeFirstLetter(category)}</span>
          </div>
          <span class="material-icons-round text-gray-300" style="font-size: 20px;" aria-hidden="true">arrow_right</span>
        `;
        const content = document.createElement('div');
        content.className = 'category-content pl-4 space-y-2 hidden mt-2';
        content.id = `category-${category}`;
        content.setAttribute('role', 'region');
        content.setAttribute('aria-labelledby', headerId);
        content.innerHTML = items
          .sort((a, b) => a.name.localeCompare(b.name))
          .map(item => `
            <div class="api-item p-3 hover:bg-purple-700/30 rounded-lg cursor-pointer transition-colors ripple" 
                 onclick="dashboard.useApi('${item.path}')"
                 role="button"
                 tabindex="0"
                 aria-label="Use ${this.capitalizeFirstLetter(item.name)} API">
              <div class="flex items-center">
                <span class="material-icons-round text-purple-300" style="font-size: 16px;" aria-hidden="true">api</span>
                <span class="font-medium text-white text-sm ml-2">${this.capitalizeFirstLetter(item.name)}</span>
                <span class="ml-auto text-xs font-bold text-purple-300">${item.method ? item.method.toUpperCase() : 'GET'}</span>
              </div>
            </div>
          `).join('');
        categoryContainer.appendChild(header);
        categoryContainer.appendChild(content);
        return categoryContainer;
      }

      setupCategoryListeners() {
        document.querySelectorAll('.category-header').forEach(header => {
          header.addEventListener('click', this.handleCategoryClick.bind(this));
          header.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              this.handleCategoryClick(e);
            }
          });
        });
        document.querySelectorAll('.api-item').forEach(item => {
          item.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              item.click();
            }
          });
        });
      }

      handleCategoryClick(e) {
        e.stopPropagation();
        const clickedHeader = e.currentTarget;
        const clickedContent = clickedHeader.nextElementSibling;
        const isExpanded = clickedHeader.getAttribute('aria-expanded') === 'true';

        // Close all other categories
        document.querySelectorAll('.category-header').forEach(header => {
          if (header !== clickedHeader && header.getAttribute('aria-expanded') === 'true') {
            header.setAttribute('aria-expanded', 'false');
            const content = header.nextElementSibling;
            content.classList.add('hidden');
            const arrow = header.querySelector('.material-icons-round:last-child');
            if (arrow) arrow.textContent = 'arrow_right';
          }
        });

        // Toggle clicked category
        if (isExpanded) {
          clickedHeader.setAttribute('aria-expanded', 'false');
          clickedContent.classList.add('hidden');
        } else {
          clickedHeader.setAttribute('aria-expanded', 'true');
          clickedContent.classList.remove('hidden');
        }
        const arrow = clickedHeader.querySelector('.material-icons-round:last-child');
        if (arrow) {
          arrow.textContent = isExpanded ? 'arrow_right' : 'arrow_drop_down';
        }
      }

      setupSidebarToggle() {
        this.menuButton.addEventListener('click', () => this.toggleSidebar());
        this.overlay.addEventListener('click', () => this.closeSidebar());
      }

      toggleSidebar() {
        if (!this.isDesktop) {
          this.isSidebarOpen = !this.isSidebarOpen;
          this.updateSidebarState();
          if (!this.isSidebarOpen) this.resetSidebarState();
        }
      }

      closeSidebar() {
        if (!this.isDesktop) {
          this.isSidebarOpen = false;
          this.updateSidebarState();
          this.resetSidebarState();
        }
      }

      updateSidebarState() {
        if (!this.isDesktop) {
          document.body.classList.toggle('sidebar-open', this.isSidebarOpen);
          this.overlay.classList.toggle('hidden', !this.isSidebarOpen);
          this.sidebar.style.transform = this.isSidebarOpen ? 'translateX(0)' : 'translateX(-100%)';
          this.menuButton.setAttribute('aria-expanded', this.isSidebarOpen.toString());
        }
      }

      // When resetting the sidebar state, also reset all category arrows to default (arrow_right)
      resetSidebarState() {
        this.searchInput.value = "";
        this.handleSearch({ target: { value: "" } });
        const searchBar = document.getElementById('sidebarSearchBar');
        const defaultHeader = document.getElementById('sidebarHeaderDefault');
        searchBar.classList.add('hidden');
        defaultHeader.classList.remove('hidden');
        document.querySelectorAll('.category').forEach(categoryContainer => {
          const header = categoryContainer.querySelector('.category-header');
          header.setAttribute('aria-expanded', 'false');
          const content = categoryContainer.querySelector('.category-content');
          content.classList.add('hidden');
          // Reset arrow to default "arrow_right"
          const arrow = header.querySelector('.material-icons-round:last-child');
          if (arrow) arrow.textContent = 'arrow_right';
          categoryContainer.style.display = "";
        });
      }

      initSearch() {
        this.searchInput.addEventListener('input', this.handleSearch.bind(this));
      }

      handleSearch(event) {
        const searchTerm = event.target.value.toLowerCase().trim();
        const isSearchEmpty = searchTerm === '';
        let hasResults = false;
        document.querySelectorAll('.category').forEach(categoryContainer => {
          const items = categoryContainer.querySelectorAll('.api-item');
          let hasVisibleItems = false;
          const content = categoryContainer.querySelector('.category-content');
          const header = categoryContainer.querySelector('.category-header');
          items.forEach(item => {
            const nameEl = item.querySelector('.font-medium');
            const name = nameEl ? nameEl.textContent.toLowerCase() : '';
            const isMatch = name.includes(searchTerm);
            item.style.display = isMatch ? '' : 'none';
            if (isMatch) {
              hasVisibleItems = true;
              hasResults = true;
            }
          });
          if (!isSearchEmpty && hasVisibleItems) {
            header.setAttribute('aria-expanded', 'true');
            content.classList.remove('hidden');
            categoryContainer.style.display = '';
          } else if (isSearchEmpty) {
            header.setAttribute('aria-expanded', 'false');
            content.classList.add('hidden');
            categoryContainer.style.display = '';
          } else {
            categoryContainer.style.display = 'none';
          }
        });
        let noResultsMsg = document.getElementById('no-search-results');
        if (!hasResults && !isSearchEmpty) {
          if (!noResultsMsg) {
            noResultsMsg = document.createElement('div');
            noResultsMsg.id = 'no-search-results';
            noResultsMsg.className = 'p-4 text-center text-purple-300 mt-4';
            noResultsMsg.setAttribute('role', 'status');
            noResultsMsg.innerHTML = `
              <div class="flex flex-col items-center">
                <span class="material-icons-round text-purple-400 mb-2" style="font-size: 24px;" aria-hidden="true">search_off</span>
                <p>No results found for "${searchTerm}"</p>
              </div>
            `;
            document.getElementById('sidebar-content').appendChild(noResultsMsg);
          } else {
            noResultsMsg.innerHTML = `
              <div class="flex flex-col items-center">
                <span class="material-icons-round text-purple-400 mb-2" style="font-size: 24px;" aria-hidden="true">search_off</span>
                <p>No results found for "${searchTerm}"</p>
              </div>
            `;
            noResultsMsg.style.display = '';
          }
        } else if (noResultsMsg) {
          noResultsMsg.style.display = 'none';
        }
      }

      initResizeHandler() {
        window.addEventListener('resize', () => {
          const wasDesktop = this.isDesktop;
          this.isDesktop = window.innerWidth >= 1024;
          if (wasDesktop !== this.isDesktop) { this.updateSidebarState(); }
        });
      }

      setupNotificationButton() {
        if (this.notificationButton) {
          this.notificationButton.addEventListener('click', (e) => {
            e.stopPropagation();
            this.toggleNotificationPanel();
          });
        }
      }

      toggleNotificationPanel() {
        if (this.notificationPanel) {
          const isVisible = !this.notificationPanel.classList.contains('hidden');
          this.notificationPanel.classList.toggle('hidden');
          this.notificationButton.setAttribute('aria-expanded', (!isVisible).toString());
        }
      }

      setupSidebarSearch() {
        const searchIcon = document.getElementById('sidebarSearchIcon');
        const searchBar = document.getElementById('sidebarSearchBar');
        const closeSearch = document.getElementById('closeSearch');
        const clearSearch = document.getElementById('clearSearch');
        const defaultHeader = document.getElementById('sidebarHeaderDefault');
        searchIcon.addEventListener('click', () => {
          defaultHeader.classList.add('hidden');
          searchBar.classList.remove('hidden');
          this.searchInput.focus();
        });
        closeSearch.addEventListener('click', () => {
          this.searchInput.value = "";
          this.handleSearch({ target: { value: "" } });
          searchBar.classList.add('hidden');
          defaultHeader.classList.remove('hidden');
          searchIcon.focus();
        });
        clearSearch.addEventListener('click', () => {
          this.searchInput.value = "";
          this.handleSearch({ target: { value: "" } });
          this.searchInput.focus();
        });
      }

      setupCopyButtons() {
        this.copyEndpointBtn.addEventListener('click', () => {
          const text = this.apiEndpointEl.textContent;
          navigator.clipboard.writeText(text).then(() => {
            this.showCopyFeedback(this.copyEndpointBtn);
          }).catch(err => {
            console.error('Failed to copy text: ', err);
            this.showErrorNotification('Failed to copy to clipboard');
          });
        });
        this.copyResponseBtn.addEventListener('click', () => {
          if (this.apiResponseContent.dataset.mediaUrl) {
            const a = document.createElement('a');
            a.href = this.apiResponseContent.dataset.mediaUrl;
            a.download = 'download';
            a.click();
          } else {
            const text = this.apiResponseContent.textContent;
            navigator.clipboard.writeText(text).then(() => {
              this.showCopyFeedback(this.copyResponseBtn);
            }).catch(err => {
              console.error('Failed to copy text: ', err);
              this.showErrorNotification('Failed to copy to clipboard');
            });
          }
        });
      }

      showCopyFeedback(button) {
        const originalText = button.innerHTML;
        button.innerHTML = `
          <span class="material-icons-round" style="font-size: 16px;" aria-hidden="true">check</span>
          <span>Copied!</span>
        `;
        button.setAttribute('aria-label', 'Copied successfully');
        setTimeout(() => {
          button.innerHTML = originalText;
          button.setAttribute('aria-label', button.id === 'copyEndpointBtn' ? 'Copy endpoint URL' : 'Copy response');
        }, 2000);
      }

      capitalizeFirstLetter(string) {
        return string.charAt(0).toUpperCase() + string.slice(1);
      }

      useApi(path) {
        const apiList = this.apiCache.get('apiList') || [];
        const api = apiList.find(item => item.path === path);
        if (api) {
          this.openApiModal(api);
        } else {
          window.open(path, '_blank', 'noopener,noreferrer');
        }
      }

      openApiModal(api) {
        this.apiResponseModalLabel.textContent = this.capitalizeFirstLetter(api.name);
        this.apiResponseModalDesc.textContent = api.desc || '';
        this.apiQueryInputContainer.innerHTML = '';
        this.apiResponseContent.innerHTML = '';
        this.apiResponseContent.dataset.mediaUrl = '';
        this.apiResponseContainer.classList.add('hidden');
        this.apiEndpointContainer.classList.add('hidden');
        this.submitQueryBtn.classList.add('hidden');
        this.apiResponseLoading.classList.add('hidden');
        const originalEndpoint = api.path;
        const [baseUrlPart, queryString] = originalEndpoint.split('?');
        const pathParamMatches = baseUrlPart.match(/:\w+/g) || [];
        const queryParams = new URLSearchParams(queryString || '');
        const hasPathParams = pathParamMatches.length > 0;
        const hasQueryParams = queryParams.toString().length > 0;
        if (hasPathParams || hasQueryParams) {
          if (hasPathParams) {
            const pathParamContainer = document.createElement('div');
            pathParamContainer.className = 'space-y-4';
            const pathTitle = document.createElement('h4');
            pathTitle.className = 'text-sm font-medium text-gray-300 mb-3';
            pathTitle.textContent = 'Path Parameters';
            pathParamContainer.appendChild(pathTitle);
            pathParamMatches.forEach(param => {
              const paramName = param.slice(1);
              const inputGroup = document.createElement('div');
              inputGroup.className = 'flex flex-col';
              const label = document.createElement('label');
              label.htmlFor = `path-param-${paramName}`;
              label.className = 'text-gray-300 mb-1 text-sm';
              label.textContent = this.capitalizeFirstLetter(paramName);
              const inputField = document.createElement('input');
              inputField.type = 'text';
              inputField.id = `path-param-${paramName}`;
              inputField.className = 'bg-black bg-opacity-50 border border-gray-700 text-white rounded-lg px-3 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all text-sm';
              inputField.placeholder = `Enter ${paramName}...`;
              inputField.dataset.paramType = 'path';
              inputField.dataset.param = paramName;
              inputField.required = true;
              inputField.addEventListener('input', () => {
                if (!inputField.value.trim()) {
                  inputField.classList.add('border-red-500');
                } else {
                  inputField.classList.remove('border-red-500');
                }
                this.validateInputs();
              });
              inputGroup.appendChild(label);
              inputGroup.appendChild(inputField);
              pathParamContainer.appendChild(inputGroup);
            });
            this.apiQueryInputContainer.appendChild(pathParamContainer);
          }
          if (hasQueryParams) {
            const queryParamContainer = document.createElement('div');
            queryParamContainer.className = 'space-y-4 mt-4';
            const queryTitle = document.createElement('h4');
            queryTitle.className = 'text-sm font-medium text-gray-300 mb-3';
            queryTitle.textContent = 'Query Parameters';
            queryParamContainer.appendChild(queryTitle);
            for (const [key, value] of queryParams.entries()) {
              const inputGroup = document.createElement('div');
              inputGroup.className = 'flex flex-col';
              const label = document.createElement('label');
              label.htmlFor = `query-param-${key}`;
              label.className = 'text-gray-300 mb-1 text-sm';
              label.textContent = this.capitalizeFirstLetter(key);
              const inputField = document.createElement('input');
              inputField.type = 'text';
              inputField.id = `query-param-${key}`;
              inputField.className = 'bg-black bg-opacity-50 border border-gray-700 text-white rounded-lg px-3 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all text-sm';
              inputField.placeholder = `Enter ${key}...`;
              inputField.dataset.paramType = 'query';
              inputField.dataset.param = key;
              inputField.value = value;
              inputField.required = true;
              inputField.addEventListener('input', () => {
                if (!inputField.value.trim()) {
                  inputField.classList.add('border-red-500');
                } else {
                  inputField.classList.remove('border-red-500');
                }
                this.validateInputs();
              });
              inputGroup.appendChild(label);
              inputGroup.appendChild(inputField);
              queryParamContainer.appendChild(inputGroup);
            }
            this.apiQueryInputContainer.appendChild(queryParamContainer);
          }
          this.submitQueryBtn.classList.remove('hidden');
          this.submitQueryBtn.disabled = true;
          this.submitQueryBtn.onclick = async () => {
            const inputs = this.apiQueryInputContainer.querySelectorAll('input');
            let isValid = true;
            const pathData = {};
            const queryData = {};
            inputs.forEach(input => {
              if (!input.value.trim()) {
                isValid = false;
                input.classList.add('border-red-500');
              } else {
                input.classList.remove('border-red-500');
                if (input.dataset.paramType === 'path') {
                  pathData[input.dataset.param] = input.value.trim();
                } else if (input.dataset.paramType === 'query') {
                  queryData[input.dataset.param] = input.value.trim();
                }
              }
            });
            if (!isValid) return;
            let finalBaseUrl = baseUrlPart;
            for (const [key, value] of Object.entries(pathData)) {
              finalBaseUrl = finalBaseUrl.replace(`:${key}`, encodeURIComponent(value));
            }
            const newQueryParams = new URLSearchParams(queryData).toString();
            let finalUrl = finalBaseUrl;
            if (newQueryParams) {
              finalUrl += `?${newQueryParams}`;
            }
            this.apiQueryInputContainer.innerHTML = '';
            this.submitQueryBtn.classList.add('hidden');
            this.handleApiRequest(finalUrl, 'get');
          };
          this.validateInputs();
        } else {
          this.handleApiRequest(api.path, 'get');
        }
        this.apiResponseModal.classList.remove('hidden');
        setTimeout(() => this.closeModalBtn.focus(), 100);
      }

      validateInputs() {
        const inputs = this.apiQueryInputContainer.querySelectorAll('input');
        const isValid = Array.from(inputs).every(input => input.value.trim() !== '');
        this.submitQueryBtn.disabled = !isValid;
        if (isValid) {
          this.submitQueryBtn.classList.remove('opacity-50', 'cursor-not-allowed');
        } else {
          this.submitQueryBtn.classList.add('opacity-50', 'cursor-not-allowed');
        }
      }

      async handleApiRequest(apiUrl, method = 'get', bodyData = null) {
        this.apiResponseLoading.classList.remove('hidden');
        this.apiResponseContainer.classList.add('hidden');
        this.apiEndpointContainer.classList.remove('hidden');
        const fullUrl = apiUrl.startsWith('http') ? apiUrl : window.location.origin + apiUrl;
        this.apiEndpointEl.textContent = fullUrl;
        try {
          const options = {
            method: method.toUpperCase(),
            headers: {}
          };
          if (method === 'post' && bodyData) {
            options.headers['Content-Type'] = 'application/json';
            options.body = JSON.stringify(bodyData);
          }
          const controller = new AbortController();
          const timeoutId = setTimeout(() => controller.abort(), 30000);
          options.signal = controller.signal;
          const response = await fetch(fullUrl, options);
          clearTimeout(timeoutId);
          if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
          const contentType = response.headers.get('Content-Type');
          if (contentType && contentType.startsWith('image/')) {
            const blob = await response.blob();
            const imageUrl = URL.createObjectURL(blob);
            const img = document.createElement('img');
            img.src = imageUrl;
            img.alt = 'API response image';
            img.className = 'max-w-full h-auto';

            this.apiResponseContent.innerHTML = '';
            this.apiResponseContent.appendChild(img);
            this.apiResponseContent.dataset.mediaUrl = imageUrl;
            this.copyResponseBtn.innerHTML = `<span class="material-icons-round" style="font-size: 16px;">download</span><span>Download</span>`;
            this.copyResponseBtn.setAttribute('aria-label', 'Download media');
          } else {
            const data = await response.json();
            const formattedJson = JSON.stringify(data, null, 2);
            this.apiResponseContent.textContent = formattedJson;
            this.apiResponseContent.innerHTML = this.syntaxHighlight(formattedJson);
            this.apiResponseContent.dataset.mediaUrl = '';
            this.copyResponseBtn.innerHTML = `<span class="material-icons-round" style="font-size: 16px;">content_copy</span><span>Copy</span>`;
            this.copyResponseBtn.setAttribute('aria-label', 'Copy response');
          }
          this.announceToScreenReader('API response received');
        } catch (error) {
          console.error('API request error:', error);
          this.apiResponseContent.textContent = `Error: ${error.message}`;
          this.apiResponseContent.classList.add('text-red-400');
          this.announceToScreenReader(`API request failed: ${error.message}`);
        } finally {
          this.apiResponseLoading.classList.add('hidden');
          this.apiResponseContainer.classList.remove('hidden');
        }
      }

      syntaxHighlight(json) {
        return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function(match) {
          let cls = 'text-purple-300';
          if (/^"/.test(match)) {
            cls = /:$/.test(match) ? 'text-purple-200' : 'text-green-300';
          } else if (/true|false/.test(match)) {
            cls = 'text-blue-300';
          } else if (/null/.test(match)) {
            cls = 'text-red-300';
          }
          return '<span class="' + cls + '">' + match + '</span>';
        });
      }

      setupModal() {
        this.closeModalBtn.addEventListener('click', () => this.closeModal());
        this.apiResponseModal.addEventListener('click', (e) => {
          if (e.target === this.apiResponseModal) {
            this.closeModal();
          }
        });
        this.apiResponseModal.addEventListener('keydown', (e) => {
          if (e.key === 'Tab') {
            const focusableElements = this.apiResponseModal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
            const firstElement = focusableElements[0];
            const lastElement = focusableElements[focusableElements.length - 1];
            if (e.shiftKey && document.activeElement === firstElement) {
              e.preventDefault();
              lastElement.focus();
            } else if (!e.shiftKey && document.activeElement === lastElement) {
              e.preventDefault();
              firstElement.focus();
            }
          }
        });
      }

      closeModal() {
        this.apiResponseModal.classList.add('hidden');
        const activeElement = document.activeElement;
        if (activeElement && activeElement.classList.contains('api-item')) {
          activeElement.focus();
        }
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      window.dashboard = new AjiroApiDashboard();
      fetch('/settings.json')
        .then(response => {
          if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
          return response.json();
        })
        .then(config => {
          document.title = config.name;
          const sidebarHeader = document.querySelector('#sidebarHeaderDefault h2');
          if (sidebarHeader) sidebarHeader.textContent = config.name;
          const mainHeader = document.querySelector('header h1');
          if (mainHeader) mainHeader.textContent = config.version;
          const creatorSpan = document.getElementById('creator');
          if (creatorSpan) creatorSpan.textContent = config.apiSettings.operator;
          // Update hero section with config values
          const heroTitle = document.querySelector('section h2');
          if (heroTitle) heroTitle.textContent = config.name;
          const heroDesc = document.querySelector('section p');
          if (heroDesc) heroDesc.textContent = config.description;
          const githubLink = document.getElementById('githubLink');
          const telegramLink = document.getElementById('telegramLink');
          if (config.links && Array.isArray(config.links)) {
            config.links.forEach(link => {
              if (link.name.toLowerCase().includes('source')) githubLink.href = link.url;
              if (link.name.toLowerCase().includes('contact')) telegramLink.href = link.url;
            });
          }
          const notificationPanel = document.getElementById('notificationPanel');
          let notificationsHtml = `
            <div class="p-3 modal-bg border-b border-gray-700">
              <h3 class="text-sm font-medium text-white">Notifications</h3>
            </div>
          `;
          if (config.notifications && config.notifications.length > 0) {
            config.notifications.forEach((notification, index) => {
              notificationsHtml += `
                <div data-index="${index}" class="p-3 border-b border-gray-700 notification-item cursor-pointer hover:bg-black hover:bg-opacity-50 transition-colors" role="menuitem" tabindex="0">
                  <div class="flex items-start">
                    <span class="material-icons-round text-purple-400 mr-2 mt-0.5" style="font-size: 16px;" aria-hidden="true">circle_notifications</span>
                    <div>
                      <h4 class="text-sm font-medium text-white">${notification.title}</h4>
                      <p class="text-xs text-gray-300 mt-1">${notification.message}</p>
                    </div>
                  </div>
                </div>
              `;
            });
          } else {
            notificationsHtml += `
              <div class="p-4 text-center text-gray-400" role="menuitem">
                <span class="material-icons-round mb-2 text-gray-500" style="font-size: 24px;" aria-hidden="true">notifications_off</span>
                <p class="text-sm">No notifications</p>
              </div>
            `;
          }
          notificationPanel.innerHTML = notificationsHtml;
          const readNotifications = JSON.parse(localStorage.getItem("readNotifications") || "[]");
          document.querySelectorAll('.notification-item').forEach(item => {
            const idx = item.getAttribute('data-index');
            if (readNotifications.includes(idx)) item.classList.add('opacity-60');
            item.addEventListener('keydown', (e) => {
              if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                item.click();
              }
            });
          });
          const notificationBadge = document.getElementById('notificationBadge');
          function updateNotificationBadge() {
            const items = document.querySelectorAll('.notification-item');
            let unreadCount = 0;
            items.forEach(item => { if (!item.classList.contains('opacity-60')) unreadCount++; });
            if (notificationBadge) {
              if (unreadCount > 0) {
                notificationBadge.textContent = unreadCount;
                notificationBadge.classList.remove('hidden');
                document.getElementById('notificationButton').setAttribute('aria-label', `Notifications (${unreadCount} unread)`);
              } else {
                notificationBadge.classList.add('hidden');
                document.getElementById('notificationButton').setAttribute('aria-label', 'Notifications');
              }
            }
          }
          updateNotificationBadge();
          document.querySelectorAll('.notification-item').forEach(item => {
            item.addEventListener('click', function() {
              const idx = item.getAttribute('data-index');
              if (!item.classList.contains('opacity-60')) {
                item.classList.add('opacity-60');
                let read = JSON.parse(localStorage.getItem("readNotifications") || "[]");
                if (!read.includes(idx)) { read.push(idx); localStorage.setItem("readNotifications", JSON.stringify(read)); }
              }
              updateNotificationBadge();
            });
          });
        })
        .catch(err => {
          console.error('Failed to load config:', err);
          if (window.dashboard && window.dashboard.showErrorNotification) {
            window.dashboard.showErrorNotification('Failed to load configuration');
          }
        });
      // Initialize particles.js with purple–pink gradient particles
      particlesJS("particles-js", {
        "particles": {
          "number": { "value": 80, "density": { "enable": true, "value_area": 800 } },
          "color": { "value": ["#9333ea", "#ec4899"] },
          "shape": { "type": "circle" },
          "opacity": { "value": 0.5, "random": false },
          "size": { "value": 3, "random": true },
          "line_linked": { "enable": true, "distance": 150, "color": "#ec4899", "opacity": 0.4, "width": 1 },
          "move": { "enable": true, "speed": 2 }
        },
        "interactivity": {
          "detect_on": "canvas",
          "events": {
            "onhover": { "enable": true, "mode": "repulse" },
            "onclick": { "enable": true, "mode": "push" }
          },
          "modes": {
            "repulse": { "distance": 100 },
            "push": { "particles_nb": 4 }
          }
        },
        "retina_detect": true
      });
    });
  </script>
</body>
</html>